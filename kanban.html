<!-- File: kanban.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Project Atlas ‚Äì Kanban board with dependencies, drag & drop, editable task modal, and configurable columns."/>
  <meta name="robots" content="noindex, nofollow"/>
  <title>Kanban Board - Project Atlas</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üóÇÔ∏è</text></svg>"/>

  <!-- Shared styles -->
  <link rel="stylesheet" href="styles.css"/>
  <link rel="stylesheet" href="atlas-interactive.css"/>

  <style>
    /* Page container */
    .page-wrap{padding:var(--space-xl);max-width:1600px;margin:0 auto}

    /* Header */
    .board-header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:var(--space-lg);margin-bottom:var(--space-md);padding-bottom:var(--space-sm);border-bottom:1px solid var(--border-default)}
    .board-title h2{margin-bottom:6px}
    .subtle{color:var(--text-secondary);font-size:.95rem}

    /* Toolbar (align with Calendar/Documents pages) */
    .toolbar{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;
      background:var(--bg-elevated);border:1px solid var(--border-light);
      border-radius:var(--radius-lg);padding:10px 12px;margin-bottom:var(--space-xl)
    }
    .toolbar .search{position:relative;flex:1;min-width:240px}
    .toolbar .search input{min-width:0;width:100%;padding:8px 34px 8px 10px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);border-radius:var(--radius-md)}
    .toolbar .search .icon{position:absolute;right:10px;top:50%;transform:translateY(-50%);opacity:.6}
    .toolbar .filter{min-width:200px}
    .toolbar select{width:100%;padding:8px 10px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);border-radius:var(--radius-md)}
    .toolbar .actions{display:flex;gap:8px;margin-left:auto}
    .btn-icon{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border-default);background:var(--bg-secondary);color:var(--text-primary);border-radius:var(--radius-md);cursor:pointer;transition:all var(--transition-fast)}
    .btn-icon:hover{border-color:var(--app-primary);background:var(--app-primary-lighter);color:var(--app-primary)}

    /* Board layout ‚Äì full width, columns wrap (no inner scroll panes) */
    .kanban{
      --col-gap:16px;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:var(--col-gap);
      align-items:start;
    }

    /* Column */
    .k-col{background:var(--bg-secondary);border:1px solid var(--border-default);border-radius:var(--radius-lg);box-shadow:var(--shadow-sm);display:flex;flex-direction:column;min-height:120px}
    .k-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;border-bottom:1px solid var(--border-light)}
    .k-title{font-weight:700}
    .k-count{color:var(--text-secondary);font-size:.85rem}
    .k-list{display:flex;flex-direction:column;gap:10px;padding:12px}

    /* Card polish */
    .k-card{background:var(--bg-secondary);border:1px solid var(--border-light);border-radius:12px;box-shadow:var(--shadow-xs);padding:10px 12px;cursor:grab}
    .k-card:active{cursor:grabbing}
    .k-card .title{font-weight:700;margin-bottom:4px}
    .k-card .sub{color:var(--text-secondary);font-size:.9rem}
    .k-card .meta{display:flex;align-items:center;gap:10px;margin-top:8px;color:var(--text-secondary);font-size:.8rem}

    /* Project color dots */
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
    .kitchen{background:#1d73e8}
    .bathroom{background:#ff9800}
    .basement{background:#43a047}

    /* Drag placeholder */
    .k-placeholder{border:2px dashed var(--border-default);border-radius:12px;height:56px}

    /* Modal roots used by atlas-interactive.js */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .15s ease;z-index:1000}
    .modal-backdrop.show{opacity:1;pointer-events:auto}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .15s ease;z-index:1001}
    .modal.open{opacity:1;pointer-events:auto}
    .modal-panel{width:min(800px,94vw);max-height:90vh;background:var(--bg-secondary);border:1px solid var(--border-default);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);display:flex;flex-direction:column;overflow:hidden}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid var(--border-light)}
    .modal-body{padding:16px;overflow:auto}
    .modal-footer{padding:12px 16px;border-top:1px solid var(--border-light);display:flex;gap:10px;justify-content:flex-end}
  </style>
</head>
<body class="app-page">
  <a href="#main" class="skip-to-main">Skip to main content</a>

  <!-- Global header (matches other pages) -->
  <header class="app-header">
    <div class="header-container">
      <div class="logo">
        <h1>Project <span class="atlas-blue">ATLAS</span></h1>
        <span class="tagline">Home Project Management</span>
      </div>

      <button class="mobile-menu-toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="mainNav"
              onclick="toggleMobileMenu()"><span aria-hidden="true">‚ò∞</span></button>

      <nav id="mainNav" class="main-nav" aria-label="Main navigation">
        <ul>
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a href="projects.html">Projects</a></li>
          <li><a href="kanban.html" class="active" aria-current="page">Kanban Board</a></li>
          <li><a href="budget.html">Budget Tracker</a></li>
          <li><a href="calendar.html">Calendar</a></li>
          <li><a href="documents.html">Documents</a></li>
        </ul>
      </nav>

      <div class="user-menu">
        <button class="user-avatar" title="User Menu">AF</button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main id="main" class="page-wrap" aria-label="Kanban">
    <!-- Page title -->
    <section class="board-header">
      <div class="board-title">
        <h2>Kanban Board</h2>
        <div class="subtle">Drag cards between columns. Click a card to view &amp; edit details.</div>
      </div>
    </section>

    <!-- Unified toolbar: Search ‚Ä¢ Assignee ‚Ä¢ Actions (+ Task / Columns) -->
    <div class="toolbar" role="region" aria-label="Board tools">
      <div class="search">
        <input id="searchTasks" aria-label="Search tasks" placeholder="Search by title, description, or tags‚Ä¶" oninput="applyFilters()"/>
        <span class="icon" aria-hidden="true">üîé</span>
      </div>

      <div class="filter">
        <select id="assigneeFilter" aria-label="Filter by assignee" onchange="applyFilters()">
          <option value="">All assignees</option>
          <!-- Intentionally no personal names in mock data -->
        </select>
      </div>

      <div class="actions">
        <button class="btn-icon" onclick="openCreateTask()" aria-label="Add task">+ Task</button>
        <button class="btn-icon" onclick="openColumnsDialog()" aria-label="Configure columns">Columns</button>
      </div>
    </div>

    <!-- Board -->
    <section id="kanban" class="kanban" aria-label="Kanban board">
      <!-- Columns and cards are injected by atlas-interactive.js -->
    </section>
  </main>

  <!-- Backdrop & Modal Root (compat with existing modal system) -->
  <div id="backdrop" class="modal-backdrop"></div>
  <div id="modalRoot" class="modal" aria-hidden="true"></div>

  <!-- Toast -->
  <div id="toast" style="position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#111;color:#fff;padding:.6rem .8rem;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.25);opacity:0;pointer-events:none;z-index:1100;"></div>

  <!-- Scripts -->
  <script src="atlas-interactive.js"></script>
  <script>
    // Mobile nav (kept consistent with other pages)
    function toggleMobileMenu(){
      const nav = document.getElementById('mainNav');
      const btn = document.querySelector('.mobile-menu-toggle');
      const on = nav.classList.toggle('active');
      if(btn) btn.setAttribute('aria-expanded', on ? 'true' : 'false');
    }

    // Optional: if the JS populates assignees, avoid showing personal names by mapping to generic labels.
    // If your dataset already avoids names, this is a no-op.
    (function anonymizeAssigneeOptions(){
      const sel = document.getElementById('assigneeFilter');
      if(!sel) return;
      // atlas-interactive.js may inject options; we observe and map if needed.
      const observer = new MutationObserver(() => {
        [...sel.options].forEach((opt, i) => {
          if(i === 0) return; // "All assignees"
          // Replace any human names with neutral labels
          if(/\w+/.test(opt.textContent)) {
            opt.textContent = `Assignee ${i}`;
          }
        });
      });
      observer.observe(sel, { childList: true });
    })();
  </script>
</body>
</html>
